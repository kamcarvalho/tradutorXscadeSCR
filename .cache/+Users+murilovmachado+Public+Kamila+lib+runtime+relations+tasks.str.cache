Module("runtime/relations/tasks",[Imports([Import("runtime/relations/entries"),Import("runtime/relations/query"),Import("runtime/relations/incremental"),Import("runtime/relations/interface"),Import("runtime/task/create"),Import("runtime/task/tasks"),Import("runtime/nabl/uri"),Import("runtime/nabl/incremental"),Import("runtime/nabl/utils")]),Signature([Constructors([OpDecl("RelationTerm",FunType([ConstType(SortNoArgs("Term"))],ConstType(SortNoArgs("Instruction")))),OpDecl("RelationLookup",FunType([ConstType(SortNoArgs("Relation")),ConstType(SortNoArgs("Term"))],ConstType(SortNoArgs("Instruction")))),OpDecl("RelationMatch",FunType([ConstType(Sort("List",[SortNoArgs("Term")])),ConstType(SortNoArgs("Term"))],ConstType(SortNoArgs("Instruction")))),OpDecl("RelationDistance",FunType([ConstType(SortNoArgs("Relation")),ConstType(SortNoArgs("Term")),ConstType(SortNoArgs("Term"))],ConstType(SortNoArgs("Instruction"))))])]),Rules([RDefT("relation-create-term",[],[DefaultVarDec("ctx")],RuleNoCond(Var("term"),App(CallT(SVar("new-task"),[],[Var("ctx")]),NoAnnoList(Op("RelationTerm",[Var("term")]))))),RDefT("perform-task",[],[DefaultVarDec("task-id")],Rule(NoAnnoList(Op("RelationTerm",[Var("term")])),NoAnnoList(Tuple([Var("term"),Var("term'")])),Seq(Assign(Var("term'"),App(CallNoArgs(SVar("relation-try-term-to-uri")),Var("term"))),BA(CallT(SVar("relation-add-read"),[],[Var("task-id")]),Var("term'")))))]),Rules([RDefT("relation-create-lookup",[],[DefaultVarDec("ctx"),DefaultVarDec("rel")],Rule(Var("term"),App(CallT(SVar("task-create-insert"),[],[Var("ctx")]),Var("lookup-task")),[WithClause(Seq(Assign(Var("term-task"),App(CallT(SVar("relation-create-term"),[],[Var("ctx")]),Var("term"))),Assign(Var("lookup-task"),App(CallT(SVar("new-task"),[],[Var("ctx")]),NoAnnoList(Op("RelationLookup",[Var("rel"),Var("term-task")]))))))])),RDefT("perform-task",[],[DefaultVarDec("task-id")],Rule(NoAnnoList(Op("RelationLookup",[Var("rel"),NoAnnoList(Tuple([Var("term"),Var("term'")]))])),Var(ListVar("result*")),Assign(Var(ListVar("result*")),App(CallT(SVar("relation-lookup"),[],[Var("rel")]),Var("term"))))),RDefNoArgs("task-get-storage-type",RuleNoCond(NoAnnoList(Op("RelationLookup",[Wld,Wld])),RootApp(CallNoArgs(SVar("task-set-storage")))))]),Rules([RDefT("relation-create-match",[],[DefaultVarDec("ctx")],RuleNoCond(NoAnnoList(Tuple([Var("rel"),Var("actual"),Var("expected")])),App(CallT(SVar("relation-create-match"),[],[Var("ctx"),Var("rel"),Var("expected")]),Var("actual")))),SDefT("relation-create-match",[],[DefaultVarDec("ctx"),DefaultVarDec("rel"),DefaultVarDec("expected")],CallT(SVar("relation-create-match"),[],[Var("ctx"),Var("rel"),Var("expected"),NoAnnoList(List([]))])),RDefT("relation-create-match",[],[DefaultVarDec("ctx"),DefaultVarDec("rel"),DefaultVarDec("expected"),DefaultVarDec(ListVar("dep*"))],Rule(Var("actual"),Var("result"),[WithClause(Seq(Assign(Var("lookup-task"),App(CallT(SVar("relation-create-lookup"),[],[Var("ctx"),Var("rel")]),Var("actual"))),Seq(Assign(Var("term-task"),App(CallT(SVar("relation-create-term"),[],[Var("ctx")]),Var("expected"))),Seq(Assign(Var(ListVar("all-dep*")),App(CallT(SVar("merge-dependencies"),[],[Var(ListVar("dep*"))]),NoAnnoList(Tuple([Var("rel"),Var("actual"),Var("expected"),Var("lookup-task"),Var("term-task")])))),Seq(Assign(Var("match-task"),App(CallT(SVar("new-task"),[],[Var("ctx"),Var(ListVar("all-dep*"))]),NoAnnoList(Op("RelationMatch",[Var("lookup-task"),Var("term-task")])))),CondChoice(Assign(Var("custom-task"),App(CallT(SVar("relation-match-custom"),[],[Var("ctx")]),NoAnnoList(Tuple([Var("rel"),Var("actual"),Var("expected")])))),Assign(Var("result"),App(CallT(SVar("task-create-choice"),[],[Var("ctx")]),NoAnnoList(List([Var("custom-task"),Var("match-task")])))),Assign(Var("result"),Var("match-task"))))))))])),RDefNoArgs("task-get-type",RuleNoCond(NoAnnoList(Op("RelationMatch",[Wld,Wld])),RootApp(CallNoArgs(SVar("task-raw-type"))))),RDefNoArgs("task-get-storage-type",RuleNoCond(NoAnnoList(Op("RelationMatch",[Wld,Wld])),RootApp(CallNoArgs(SVar("task-set-storage")))))]),Rules([RDefT("relation-create-distance",[],[DefaultVarDec("ctx"),DefaultVarDec("rel"),DefaultVarDec("values")],RuleNoCond(Var("actual"),App(CallT(SVar("new-task"),[],[Var("ctx")]),NoAnnoList(Op("RelationDistance",[Var("rel"),Var("actual"),Var("values")]))))),SDefNoArgs("task-is-combinator",Match(NoAnnoList(Op("RelationDistance",[Wld,Wld,Wld])))),RDefT("perform-task",[],[DefaultVarDec("task-id")],RuleNoCond(NoAnnoList(Op("RelationDistance",[Var("rel"),Var("actual"),Var(ListVar("value*"))])),NoAnnoList(List([App(CallNoArgs(SVar("get-index")),NoAnnoList(Tuple([App(Seq(CallNoArgs(SVar("try-remove-list")),CallNoArgs(SVar("relation-try-term-to-uri"))),Var("actual")),App(Call(SVar("map"),[CallNoArgs(SVar("relation-try-term-to-uri"))]),Var(ListVar("value*")))])))]))))])])