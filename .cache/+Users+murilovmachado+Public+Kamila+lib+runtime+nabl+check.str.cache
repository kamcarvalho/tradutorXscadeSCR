Module("runtime/nabl/check",[Imports([Import("runtime/nabl/resolve"),Import("runtime/nabl/collect"),Import("runtime/nabl/query"),Import("runtime/nabl/tasks"),Import("runtime/nabl/entries"),Import("runtime/nabl/interface"),Import("runtime/nabl/uri"),Import("runtime/nabl/utils"),Import("runtime/task/core"),Import("runtime/task/messages"),Import("runtime/task/tasks")]),Rules([RDefT("nabl-unresolved-task",[],[DefaultVarDec("partition"),DefaultVarDec("task")],Rule(Var("name"),Var("name"),[WhereClause(Not(CallNoArgs(SVar("nabl-check-disable-unresolved")))),WithClause(BA(Seq(CallNoArgs(SVar("nabl-fix-name")),CallT(SVar("task-create-error-on-failure"),[],[Var("partition"),Var("task"),NoAnnoList(Str("\"Unresolved reference\""))])),Var("name")))])),RDefT("nabl-duplicate-task",[],[DefaultVarDec("ctx"),DefaultVarDec("unique")],Rule(Var("name"),Var("name"),[WhereClause(Seq(Assign(Var("uri"),App(CallNoArgs(SVar("nabl-uri")),Var("name"))),Seq(Assign(Var("ns"),App(CallNoArgs(SVar("nabl-uri-namespace")),Var("uri"))),Not(BA(CallT(SVar("nabl-check-disable-duplicate"),[],[Var("uri"),Var("ns")]),Var("name")))))),WithClause(IfThen(Assign(NoAnnoList(Op("Unique",[])),Var("unique")),Seq(Assign(Var("uri'"),App(CallNoArgs(SVar("nabl-uri-parent")),Var("uri"))),Seq(Assign(Var("resolve"),App(CallT(SVar("nabl-create-resolvedefs"),[],[Var("ctx"),Var("ns"),Var("name"),NoAnnoList(List([]))]),Var("uri'"))),CondChoice(Seq(Assign(Var("parent"),App(CallNoArgs(SVar("nabl-uri-name")),Var("uri'"))),Assign(Var("parent-ns"),App(CallNoArgs(SVar("nabl-uri-namespace")),Var("uri'")))),BA(CallT(SVar("task-create-error-on-multiple"),[],[Var("ctx"),Var("resolve"),NoAnnoList(List([NoAnnoList(Str("\"Duplicate \"")),App(CallNoArgs(SVar("pp-ns")),Var("ns")),NoAnnoList(Str("\" \"")),Var("name"),NoAnnoList(Str("\" in \"")),App(CallNoArgs(SVar("pp-ns")),Var("parent-ns")),NoAnnoList(Str("\" \"")),Var("parent")]))]),Var("name")),BA(CallT(SVar("task-create-error-on-multiple"),[],[Var("ctx"),Var("resolve"),NoAnnoList(List([NoAnnoList(Str("\"Duplicate \"")),App(CallNoArgs(SVar("pp-ns")),Var("ns")),NoAnnoList(Str("\" \"")),Var("name")]))]),Var("name")))))))])),SDefNoArgs("pp-ns",Seq(CallNoArgs(SVar("write-to-string")),CallT(SVar("string-replace"),[],[NoAnnoList(Str("\"NablNs\"")),NoAnnoList(Str("\"\""))])))]),Rules([SDefNoArgs("nabl-is-unresolved",Seq(Match(Var("node")),Seq(CallNoArgs(SVar("has-annos")),Seq(CallNoArgs(SVar("get-annos")),Seq(Where(CallNoArgs(SVar("nabl-has-reference"))),Not(CallNoArgs(SVar("nabl-collect-one-resolved-def")))))))),SDefNoArgs("nabl-get-ambiguities",Seq(CallNoArgs(SVar("nabl-collect-all-resolved-defs")),Seq(Call(SVar("mapconcat"),[CallNoArgs(SVar("nabl-get-all-aliases"))]),Seq(Call(SVar("filter"),[Seq(CallNoArgs(SVar("nabl-uri")),CallNoArgs(SVar("nabl-uri-parent")))]),Seq(CallNoArgs(SVar("make-set")),Where(BA(CallNoArgs(SVar("gt")),NoAnnoList(Tuple([RootApp(CallNoArgs(SVar("length"))),NoAnnoList(Int("1"))]))))))))),SDefNoArgs("nabl-get-duplicate-definitions",Seq(CallNoArgs(SVar("has-annos")),Seq(CallNoArgs(SVar("get-annos")),Seq(Call(SVar("collect-one"),[Match(NoAnnoList(Op("Def",[Wld])))]),Seq(CallNoArgs(SVar("nabl-get-all-definitions")),Seq(CallNoArgs(SVar("make-set")),Where(BA(CallNoArgs(SVar("gt")),NoAnnoList(Tuple([RootApp(CallNoArgs(SVar("length"))),NoAnnoList(Int("1"))]))))))))))])])