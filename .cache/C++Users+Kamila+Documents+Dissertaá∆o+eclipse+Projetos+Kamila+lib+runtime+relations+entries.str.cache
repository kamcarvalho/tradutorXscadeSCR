Module("runtime/relations/entries",[Imports([Import("runtime/relations/entries"),Import("runtime/relations/interface"),Import("runtime/relations/tasks"),Import("runtime/index/core"),Import("runtime/properties/query"),Import("runtime/nabl/resolve"),Import("runtime/nabl/entries"),Import("runtime/nabl/utils"),Import("runtime/task/core"),Import("runtime/task/insert"),Import("runtime/task/utils"),Import("runtime/editor/origins")]),Signature([Constructors([OpDecl("RelTuple",FunType([ConstType(SortNoArgs("Term")),ConstType(SortNoArgs("Relation"))],ConstType(SortNoArgs("Key")))),OpDecl("Inverse",FunType([ConstType(SortNoArgs("Relation"))],ConstType(SortNoArgs("Relation")))),OpDecl("Transitive",FunType([ConstType(SortNoArgs("Relation"))],ConstType(SortNoArgs("Relation"))))])]),Rules([RDefT("new-rel-tuple",[],[DefaultVarDec("source"),DefaultVarDec("rel"),DefaultVarDec("t2")],Rule(Var("t1"),Var("tuple"),[WithClause(Seq(CallNoArgs(SVar("relation-ensure-no-task-reference")),Assign(Var("t1'"),App(CallNoArgs(SVar("relation-try-term-to-uri")),Var("t1"))))),WithClause(Seq(Assign(Var("tuple"),NoAnnoList(Op("RelTuple",[Var("t1'"),Var("rel")]))),Seq(BA(CallT(SVar("index-collect"),[],[App(Call(SVar("origin-track-forced"),[Build(Var("t2"))]),Var("t1")),Var("source")]),Var("tuple")),IfThen(BA(CallNoArgs(SVar("relation-is-transitive")),Var("rel")),Seq(Assign(Var("task"),App(CallT(SVar("relation-create-lookup"),[],[Var("source"),Var("rel")]),Var("t2"))),BA(CallT(SVar("index-collect"),[],[App(Call(SVar("origin-track-forced"),[Build(Var("task"))]),Var("t1")),Var("source")]),NoAnnoList(Op("RelTuple",[Var("t1'"),NoAnnoList(Op("Transitive",[Var("rel")]))]))))))))]))]),Rules([SDefNoArgs("relation-ensure-no-task-reference",CallT(SVar("with"),[Not(Call(SVar("collect-one-annos"),[CallNoArgs(SVar("relation-is-unresolved-use"))]))],[NoAnnoList(StringQuotation1("        ",[QStr("Cannot create a relation tuple with a reference to a resolution task on the left hand side.")]))])),RDefNoArgs("relation-try-term-to-uri",Rule(Var("term"),Var("result"),CondChoice(Assign(Var("use"),App(Call(SVar("collect-one-annos"),[CallNoArgs(SVar("relation-is-unresolved-use"))]),Var("term"))),Assign(Var("result"),App(CallNoArgs(SVar("relation-resolve-use")),Var("use"))),Assign(Var("result"),App(Call(SVar("try"),[Call(SVar("collect-one-annos"),[CallNoArgs(SVar("relation-get-uri"))])]),Var("term")))))),RDefNoArgs("relation-get-uri",RuleNoCond(NoAnnoList(Op("Def",[Var("uri")])),Var("uri"))),RDefNoArgs("relation-get-uri",RuleNoCond(NoAnnoList(Op("Use",[NoAnnoList(Op("Def",[Var("uri")]))])),Var("uri"))),SDefNoArgs("relation-is-unresolved-use",Match(NoAnnoList(Op("Use",[NoAnnoList(Op("Result",[Wld]))])))),RDefNoArgs("relation-resolve-use",RuleNoCond(NoAnnoList(Op("Use",[As(Var("r"),NoAnnoList(Op("Result",[Wld])))])),App(Seq(CallNoArgs(SVar("insert-results-or-delay")),Seq(CallNoArgs(SVar("Hd")),CallNoArgs(SVar("nabl-uri")))),Var("r"))))]),Rules([RDefNoArgs("relation-tuple-key",RuleNoCond(NoAnnoList(Op("RelTuple",[Var("key"),Wld])),Var("key")))])])